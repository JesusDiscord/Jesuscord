"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cleanOldVersions=cleanOldVersions,exports.init=init,exports.getUserData=getUserData,exports.getUserDataVersioned=getUserDataVersioned,exports.getResources=getResources,exports.getModuleDataPath=getModuleDataPath,exports.getInstallPath=getInstallPath;var _fs=_interopRequireDefault(require("fs")),_mkdirp=_interopRequireDefault(require("mkdirp")),_path=_interopRequireDefault(require("path")),_rimraf=_interopRequireDefault(require("rimraf"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const originalFs=require("original-fs");let userDataPath=null,userDataVersionedPath=null,resourcesPath=null,moduleDataPath=null,installPath=null;function determineAppUserDataRoot(){const{app:e}=require("electron");return e.getPath("appData")}function determineUserData(e,t){return _path.default.join(e,"discord"+("stable"==t.releaseChannel?"":t.releaseChannel))}function cleanOldVersions(e){(_fs.default.readdirSync(userDataPath)||[]).forEach(t=>{const a=_path.default.join(userDataPath,t);_fs.default.lstatSync(a).isDirectory()&&-1===t.indexOf(e.version)&&null!=t.match("^[0-9]+.[0-9]+.[0-9]+")&&(console.log("Removing old directory ",t),(0,_rimraf.default)(a,originalFs,e=>{e&&console.warn("...failed with error: ",e)}))})}function init(e){resourcesPath=_path.default.join(require.main.filename,"..","..","..");const t=determineAppUserDataRoot();userDataPath=determineUserData(t,e);const{app:a}=require("electron");a.setPath("userData",userDataPath),userDataVersionedPath=_path.default.join(userDataPath,e.version),_mkdirp.default.sync(userDataVersionedPath),moduleDataPath=null!=e.localModulesRoot?e.localModulesRoot:e.newUpdater?_path.default.join(userDataPath,"module_data"):_path.default.join(userDataVersionedPath,"modules");const r=_path.default.dirname(a.getPath("exe"));/^app-[0-9]+\.[0-9]+\.[0-9]+/.test(_path.default.basename(r))&&(installPath=_path.default.join(r,".."))}function getUserData(){return userDataPath}function getUserDataVersioned(){return userDataVersionedPath}function getResources(){return resourcesPath}function getModuleDataPath(){return moduleDataPath}function getInstallPath(){return installPath}