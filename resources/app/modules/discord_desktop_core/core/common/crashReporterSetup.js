"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.init=init,exports.isInitialized=isInitialized,exports.metadata=void 0;const electron=require("electron"),childProcess=require("child_process"),{flatten:flatten}=require("./crashReporterUtils");let initialized=!1;const metadata={};exports.metadata=metadata;const DEFAULT_SENTRY_KEY="384ce4413de74fe0be270abe03b2b35a",TEST_SENTRY_KEY="1a27a96457b24ff286a000266c573919",CHANNEL_SENTRY_KEYS={stable:DEFAULT_SENTRY_KEY,ptb:TEST_SENTRY_KEY,canary:TEST_SENTRY_KEY,development:TEST_SENTRY_KEY};function getCrashReporterArgs(e){let t=flatten(e);const a=e.channel;return{productName:"Discord",companyName:"Discord Inc.",submitURL:"https://sentry.io/api/146342/minidump/?sentry_key="+(null!=CHANNEL_SENTRY_KEYS[a]?CHANNEL_SENTRY_KEYS[a]:DEFAULT_SENTRY_KEY),uploadToServer:!0,ignoreSystemCrashHandler:!1,extra:t}}function init(e){if(initialized)return void console.warn("Ignoring double initialization of crash reporter.");metadata.channel=e.releaseChannel;const t=null!=metadata.sentry?metadata.sentry:{};if(t.environment=e.releaseChannel,t.release=e.version,metadata.sentry=t,"linux"===process.platform){const e=process.env.XDG_CURRENT_DESKTOP||"unknown",t=process.env.GDMSESSION||"unknown";metadata.wm=`${e},${t}`;try{metadata.distro=childProcess.execFileSync("lsb_release",["-ds"],{timeout:100,maxBuffer:512,encoding:"utf-8"}).trim()}catch(e){}}getCrashReporterArgs(metadata);initialized=!0}function isInitialized(){return initialized}