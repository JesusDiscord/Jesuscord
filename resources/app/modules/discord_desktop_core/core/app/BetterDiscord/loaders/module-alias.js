"use strict";var BuiltinModule=require("module"),Module=module.constructor.length>1?module.constructor:BuiltinModule,nodePath=require("path"),modulePaths=[],moduleAliases={},moduleAliasNames=[],oldNodeModulePaths=Module._nodeModulePaths;Module._nodeModulePaths=function(e){var a=oldNodeModulePaths.call(this,e);return-1===e.indexOf("node_modules")&&(a=modulePaths.concat(a)),a};var oldResolveFilename=Module._resolveFilename;function isPathMatchesAlias(e,a){if(0===e.indexOf(a)){if(e.length===a.length)return!0;if("/"===e[a.length])return!0}return!1}function addPathHelper(e,a){e=nodePath.normalize(e),a&&-1===a.indexOf(e)&&a.unshift(e)}function removePathHelper(e,a){if(a){var o=a.indexOf(e);-1!==o&&a.splice(o,1)}}function addPath(e){var a;if(e=nodePath.normalize(e),-1===modulePaths.indexOf(e)){modulePaths.push(e);var o=getMainModule();for(o&&addPathHelper(e,o.paths),a=module.parent;a&&a!==o;)addPathHelper(e,a.paths),a=a.parent}}function addAliases(e){for(var a in e)addAlias(a,e[a])}function addAlias(e,a){moduleAliases[e]=a,(moduleAliasNames=Object.keys(moduleAliases)).sort()}function reset(){var e=getMainModule();modulePaths.forEach((function(a){e&&removePathHelper(a,e.paths),Object.getOwnPropertyNames(require.cache).forEach((function(e){-1!==e.indexOf(a)&&delete require.cache[e]}));for(var o=module.parent;o&&o!==e;)removePathHelper(a,o.paths),o=o.parent})),modulePaths=[],moduleAliases={},moduleAliasNames=[]}function init(e){var a,o,t;for(var n in"string"==typeof e&&(e={base:e}),a=(e=e||{}).base?[nodePath.resolve(e.base.replace(/\/package\.json$/,""))]:[nodePath.join(__dirname,"../.."),process.cwd()])try{t=a[n],o=require(nodePath.join(t,"package.json"));break}catch(e){}if("object"!=typeof o){var i=a.join(",\n");throw new Error("Unable to find package.json in any of:\n["+i+"]")}var l=o._moduleAliases||{};for(var r in l)"/"!==l[r][0]&&(l[r]=nodePath.join(t,l[r]));addAliases(l),o._moduleDirectories instanceof Array&&o._moduleDirectories.forEach((function(e){"node_modules"!==e&&addPath(nodePath.join(t,e))}))}function getMainModule(){return require.main._simulateRepl?void 0:require.main}Module._resolveFilename=function(e,a,o,t){for(var n=moduleAliasNames.length;n-- >0;){var i=moduleAliasNames[n];if(isPathMatchesAlias(e,i)){var l=moduleAliases[i];if("function"==typeof moduleAliases[i]){var r=a.filename;if(!(l=moduleAliases[i](r,e,i))||"string"!=typeof l)throw new Error("[module-alias] Expecting custom handler function to return path.")}e=nodePath.join(l,e.substr(i.length));break}}return oldResolveFilename.call(this,e,a,o,t)},module.exports=init,module.exports.addPath=addPath,module.exports.addAlias=addAlias,module.exports.addAliases=addAliases,module.exports.isPathMatchesAlias=isPathMatchesAlias,module.exports.reset=reset,module.exports.setMain=function(e){require.main=e};