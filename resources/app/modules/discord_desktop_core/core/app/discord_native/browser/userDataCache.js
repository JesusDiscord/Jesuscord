"use strict";var _electron=_interopRequireDefault(require("electron")),_fs=_interopRequireDefault(require("fs")),_path=_interopRequireDefault(require("path")),_appFeatures=require("../../appFeatures"),paths=_interopRequireWildcard(require("../../paths")),_constants=require("../common/constants");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=a?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const{USER_DATA_CACHE_SAVE:USER_DATA_CACHE_SAVE,USER_DATA_CACHE_GET:USER_DATA_CACHE_GET,USER_DATA_CACHE_DELETE:USER_DATA_CACHE_DELETE}=_constants.IPCEvents,features=(0,_appFeatures.getFeatures)();function getCachePath(){return _path.default.join(paths.getUserData(),"userDataCache.json")}function getMigratedPath(){return _path.default.join(paths.getUserData(),"domainMigrated")}function cacheUserData(e){_fs.default.writeFile(getCachePath(),e,e=>{e&&console.warn("Failed updating user data cache with error: ",e)})}function getCachedUserData(){try{return JSON.parse(_fs.default.readFileSync(getCachePath()))}catch(e){}return null}function deleteCachedUserData(){try{_fs.default.unlinkSync(getCachePath()),_fs.default.writeFile(getMigratedPath(),"",e=>{e&&console.warn("Failed to create domainMigrated file with error: ",e)})}catch(e){}}_electron.default.ipcMain.handle(USER_DATA_CACHE_GET,()=>getCachedUserData()),_electron.default.ipcMain.on(USER_DATA_CACHE_SAVE,(e,t)=>{cacheUserData(t)}),_electron.default.ipcMain.on(USER_DATA_CACHE_DELETE,e=>{deleteCachedUserData()}),features.declareSupported("user_data_cache");