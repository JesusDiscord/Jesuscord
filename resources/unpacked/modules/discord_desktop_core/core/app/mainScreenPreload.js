"use strict";if(!process.isMainFrame)throw new Error("Preload scripts should not be running in a subframe");if(null===window.opener){const{contextBridge:e}=require("electron");process.on("uncaughtException",console.error);const r=require("./discord_native/renderer/ipc"),i=require("electron"),o=require("./BetterDiscord/loaders/module-alias"),n=require("path");o.setMain(module),o.addAlias("@lightcord/api",n.join(__dirname,"../../../../LightcordApi")),o.addAlias("lightcordapi",n.join(__dirname,"../../../../LightcordApi")),o.addPath(n.join(__dirname,"BetterDiscord","modules"));const t={isRenderer:"renderer"===process.type,nativeModules:require("./discord_native/renderer/nativeModules"),process:require("./discord_native/renderer/process"),os:require("./discord_native/renderer/os"),app:require("./discord_native/renderer/app"),clipboard:require("./discord_native/renderer/clipboard"),ipc:r,gpuSettings:require("./discord_native/renderer/gpuSettings"),window:require("./discord_native/renderer/window"),powerMonitor:require("./discord_native/renderer/powerMonitor"),spellCheck:require("./discord_native/renderer/spellCheck"),crashReporter:require("./discord_native/renderer/crashReporter"),desktopCapture:require("./discord_native/renderer/desktopCapture"),fileManager:require("./discord_native/renderer/fileManager"),processUtils:require("./discord_native/renderer/processUtils"),powerSaveBlocker:require("./discord_native/renderer/powerSaveBlocker"),http:require("./discord_native/renderer/http"),accessibility:require("./discord_native/renderer/accessibility"),features:require("./discord_native/renderer/features"),settings:require("./discord_native/renderer/settings"),userDataCache:require("./discord_native/renderer/userDataCache")};t.remoteApp=t.app,t.remotePowerMonitor=t.powerMonitor,window.DiscordNative=t;const d=require("./BetterDiscord");(()=>{let e=setInterval(()=>{if(document.querySelector('video[class*="ready-"]')){clearInterval(e);let r=setInterval(async()=>{if(!document.querySelector('video[class*="ready-"]')){function e(e,r,i=!1){let o=[];for(const n in e)if(e.hasOwnProperty(n)){const t=e[n].exports;t&&(t.default&&t.__esModule&&r(t.default)&&(i?o.push(t):o.push(t.default)),r(t)&&o.push(t))}return o}clearInterval(r);const i={modules:function(){let e;return webpackChunkdiscord_app.push([[Math.random().toString(36)],{},r=>{e=r}]),e.c}(),find:(r,o)=>e(i.modules,r,o)[0],findAll:(r,o)=>e(i.modules,r,o),findByProps:(...e)=>i.find(r=>e.every(e=>void 0!==r[e])),findByPropsAll:(...e)=>i.findAll(r=>e.every(e=>void 0!==r[e])),findByPrototypes:(...e)=>i.find(r=>r.prototype&&e.every(e=>void 0!==r.prototype[e])),findByDisplayName:e=>i.find(r=>r.displayName===e),findByDisplayNameAll:e=>i.findAll(r=>r.displayName===e),findByStrings:(...e)=>i.find(r=>"function"!=typeof r?findInTree(r,r=>{if(r)for(const i of Object.values(r))if("function"==typeof i&&e.every(e=>i.toString().includes(e)))return!0}):!!e.every(e=>r.toString().includes(e))||void 0),findByKeywordAll:(...e)=>i.findAll(r=>e.every(e=>1==Object.keys(r).some(r=>r.toLowerCase().includes(e.toLowerCase()))))},o=i.findByPrototypes("setSelfDeaf"),n=o.prototype.initialize;o.prototype.initialize=function(...e){let r=n.call(this,...e),i=this.conn.setTransportOptions;return this.conn.setTransportOptions=function(e){return console.log("Jesuscord Injected"),e.audioEncoder&&(e.audioEncoder.params={stereo:"4"},e.audioEncoder.channels=2,e.audioEncoder.freq=48e3,e.audioEncoder.rate=960,e.audioEncoder.pacsize=40),e.attenuation=!0,e.attenuateWhileSpeakingSelf=!0,e.attenuateWhileSpeakingOthers=!1,e.attenuationFactor=200,e.prioritySpeakerDucking=0,512e3!=e.encodingVoiceBitRate&&(e.encodingVoiceBitRate=512e3),e.fec&&(e.fec=!1),512e3!=e.encodingBitRate&&(e.encodingBitRate=512e3),e.localPans={left:"1",right:"1"},i.call(this,e)},r}}},200)}},200)})(),process.once("loaded",()=>{global.DiscordNative=t;const e=i.ipcRenderer.sendSync("LIGHTCORD_GET_BUILD_INFOS");console.log("%c%s","color: #3767ad;font-size:25px","Jesuscord Client\nhttps://github.com/Lightcord/Lightcord"),console.log("%c%s","font-size:15px",`Version: ${e.version}\nCommit: ${e.commit||"Unknown"}`);let r=Date.now();d.init({isTab:!1}),d.events.on("debug",d.logger.log.bind(d.logger)),d.events.on("ready",()=>{d.logger.log("BetterDiscord Loaded. took: "+(Date.now()-r)+"ms.");try{BDModules.get(e=>e.AnalyticsActionHandlers)[1].AnalyticsActionHandlers.handleTrack=(()=>!1)}catch(e){}})}),window.popouts=new Map}else window.addEventListener("load",e=>{window.opener.popouts.set(window.name,window)}),window.addEventListener("beforeunload",e=>{window.opener.popouts.delete(window.name)});